# 機能設計書

## 概要

問い合わせフォームアプリケーションの機能要件と非機能要件を定義します。ユーザーストーリー駆動開発（USDD）に基づき、実際のユーザーニーズを反映した仕様を記載しています。

## ユーザーストーリー

### US-001: 問い合わせフォームから連絡を送信する

**As a** Webサイトの訪問者  
**I want** 問い合わせフォームから連絡を送信したい  
**So that** サービスについて質問や相談ができる

#### 受入基準

| ID | 説明 | 必須 | 実装状況 |
|----|------|------|---------|
| AC-001-1 | 名前、メールアドレス、件名、本文が入力できる | ✅ | ✅ 完了 |
| AC-001-2 | 必須項目が未入力の場合、エラーメッセージが表示される | ✅ | ✅ 完了 |
| AC-001-3 | メールアドレスの形式が不正な場合、エラーメッセージが表示される | ✅ | ✅ 完了 |
| AC-001-4 | 送信成功時に確認メッセージが表示される | 必須 | 未完了 |

#### シナリオ

**SC-001-1: 正常な問い合わせ送信**
- **Given**: 問い合わせフォームページを開いている
- **When**: 
  - 名前に「田中太郎」を入力する
  - メールアドレスに「tanaka@example.com」を入力する
  - 件名に「サービスについて」を入力する
  - 本文に「詳細を教えてください」を入力する
  - プライバシーポリシーに同意する
  - 送信ボタンをクリックする
- **Then**: 
  - 「お問い合わせを受け付けました」というメッセージが表示される
  - フォームがクリアされる

**SC-001-2: 必須項目未入力でのエラー**
- **Given**: 問い合わせフォームページを開いている
- **When**: 
  - 名前を入力せずに送信ボタンをクリックする
- **Then**: 
  - 「お名前は必須です」というエラーメッセージが表示される
  - フォームは送信されない

**SC-001-3: 不正なメールアドレス形式**
- **Given**: 問い合わせフォームページを開いている
- **When**: 
  - 名前に「田中太郎」を入力する
  - メールアドレスに「invalid-email」を入力する
  - 件名とメッセージを正しく入力する
  - 送信ボタンをクリックする
- **Then**: 
  - 「有効なメールアドレスを入力してください」というエラーメッセージが表示される
  - フォームは送信されない

### US-002: 入力内容を確認してから送信する

**As a** Webサイトの訪問者  
**I want** 送信前に入力内容を確認したい  
**So that** 誤った内容を送信することを防げる

#### 受入基準

| ID | 説明 | 必須 | 実装状況 |
|----|------|------|---------|
| AC-002-1 | 確認画面で入力内容が表示される | ⚠️ | ❌ 未実装 |
| AC-002-2 | 確認画面から編集画面に戻れる | ⚠️ | ❌ 未実装 |
| AC-002-3 | 確認画面から送信できる | ⚠️ | ❌ 未実装 |

**注記**: 
- 現在の実装では確認画面機能は含まれていません
- `ConfirmationFlow`ストーリーは存在しますが、実際には通常のフォーム送信のみを行っています
- ユーザーストーリーとテストデータは将来の実装に向けて準備されています
- 実際の確認画面コンポーネントやUI実装は今後の課題です

### US-003: 入力途中の内容を保持する

**As a** Webサイトの訪問者  
**I want** 入力途中でページを離れても内容を保持したい  
**So that** 再度入力する手間を省ける

#### 受入基準

| ID | 説明 | 必須 | 実装状況 |
|----|------|------|---------|
| AC-003-1 | 入力内容がローカルストレージに保存される | ✅ | ✅ 完了 |
| AC-003-2 | ページを再読み込みしても入力内容が復元される | ✅ | ✅ 完了 |
| AC-003-3 | 送信完了後は保存内容がクリアされる | ✅ | ✅ 完了 |

#### シナリオ

**SC-003-1: 入力内容の自動保存と復元**
- **Given**: 問い合わせフォームページを開いている
- **When**: 
  - 名前に「田中太郎」を入力する
  - ページを再読み込みする
- **Then**: 
  - 名前欄に「田中太郎」が表示されている

## 機能要件

### 1. フォーム入力機能

#### 1.1 入力フィールド

| フィールド | 型 | 必須 | 最大文字数 | バリデーション |
|------------|----|----|-----------|----------------|
| 名前 | text | ✅ | 100 | 1文字以上、100文字以下 |
| メールアドレス | email | ✅ | 255 | RFC準拠のメール形式 |
| 件名 | text | ✅ | 200 | 1文字以上、200文字以下 |
| お問い合わせ内容 | textarea | ✅ | 2000 | 10文字以上、2000文字以下 |
| プライバシーポリシー同意 | checkbox | ✅ | - | true である必要がある |

#### 1.2 バリデーション仕様

**リアルタイムバリデーション**
- **トリガー**: `onBlur` イベント
- **表示タイミング**: フィールドからフォーカスが外れた時
- **エラー解消**: 正しい値を入力してフォーカスを外した時

**エラーメッセージ**

| フィールド | 条件 | メッセージ |
|------------|------|------------|
| 名前 | 未入力 | お名前は必須です |
| 名前 | 100文字超過 | 名前は100文字以内で入力してください |
| メールアドレス | 未入力 | メールアドレスは必須です |
| メールアドレス | 形式不正 | 有効なメールアドレスを入力してください |
| メールアドレス | 255文字超過 | メールアドレスは255文字以内で入力してください |
| 件名 | 未入力 | 件名は必須です |
| 件名 | 200文字超過 | 件名は200文字以内で入力してください |
| お問い合わせ内容 | 未入力 | お問い合わせ内容は必須です |
| お問い合わせ内容 | 10文字未満 | お問い合わせ内容は10文字以上で入力してください |
| お問い合わせ内容 | 2000文字超過 | お問い合わせ内容は2000文字以内で入力してください |
| プライバシーポリシー | 未チェック | プライバシーポリシーへの同意が必要です |

### 2. 送信機能

#### 2.1 送信処理

**送信フロー**
1. フォーム送信ボタンクリック
2. 全フィールドの最終バリデーション実行
3. バリデーション成功の場合:
   - 送信ボタンの無効化 + 「送信中...」表示
   - API呼び出し（1秒のシミュレーション）
   - 成功時: 成功メッセージ表示、フォームリセット、自動保存データクリア
   - 失敗時: エラーメッセージ表示
4. バリデーション失敗の場合:
   - エラーメッセージ表示
   - 送信処理を実行しない

#### 2.2 UI状態管理

| 状態 | ボタンテキスト | ボタン状態 | 入力フィールド状態 |
|------|---------------|------------|-------------------|
| 通常 | 送信する | 有効 | 有効 |
| 送信中 | 送信中... | 無効 | 無効 |
| 送信成功 | 送信する | 有効 | 有効（リセット済み） |

### 3. 自動保存機能

#### 3.1 保存仕様

**保存タイミング**
- 各フィールドの値が変更されてから500ms後
- ただし、送信成功状態の場合は保存しない

**保存対象**
- 名前
- メールアドレス  
- 件名
- お問い合わせ内容
- プライバシーポリシー同意状態

**保存場所**
- ブラウザのローカルストレージ
- キー: `contact-form-storage`

**保存条件**
- いずれかのフィールドに値が存在する場合のみ

#### 3.2 復元仕様

**復元タイミング**
- コンポーネントマウント時
- `enableAutoSave` が `true` の場合のみ

**復元処理**
- ローカルストレージから保存データを取得
- React Hook Form の `setValue` で各フィールドに値を設定

#### 3.3 クリア仕様

**クリアタイミング**
- 送信成功時
- テスト実行時（`resetStore` 呼び出し）

### 4. 成功メッセージ表示

#### 4.1 表示仕様

**表示内容**: 「お問い合わせを受け付けました」  
**表示位置**: フォーム上部  
**表示期間**: 3秒間  
**スタイル**: 成功を示す視覚的スタイル（緑色背景など）